<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a href="index.html" class="navbar-brand">
                <i class="fas fa-graduation-cap me-2"></i>Sistema Educacional
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a href="#" class="nav-link active">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="login.html" class="nav-link">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="bg-light py-4">
        <div class="container">
            <h1 class="display-5 fw-bold">Disciplina</h1>
            <p class="lead">Gerencie as Relações Academicas</p>
        </div>
    </header>

    <form action="" class="container">
        <div class="row">
            <div class="col">
                <select id="aluno" class="form-select">
                    <option value="">Selecione um aluno</option>
                </select>
            </div>
            <div class="col">
                <select id="curso" class="form-select">
                    <option value="">Selecione um curso</option>
                </select>
            </div>
            <div class="col">
                <select id="disciplina" class="form-select">
                    <option value="">Selecione uma disciplina</option>
                </select>
            </div>
        </div>
    </form>

    <div class="container mt-5">
        <h2>Relações Academicas</h2>
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Aluno</th>
                    <th>Curso</th>
                    <th>Disciplina</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="alunosTable"></tbody>
        </table>
    </div>

    <script>
        let editarRelacaoId = null;

        window.onload = async () => {
            try {
                const response = await fetch('http://localhost:5210/api/DisciplinaAlunoCurso');
                const relacoes = await response.json();

                // Verificando os dados retornados pela API
                console.log('Relacoes retornadas da API:', relacoes);

                const alunoSelect = document.getElementById('aluno');
                const cursoSelect = document.getElementById('curso');
                const disciplinaSelect = document.getElementById('disciplina');

                // Limpar e adicionar a primeira opção
                alunoSelect.innerHTML = '<option value="">Selecione um aluno</option>';
                cursoSelect.innerHTML = '<option value="">Selecione um curso</option>';
                disciplinaSelect.innerHTML = '<option value="">Selecione uma disciplina</option>';

                // Utilizar Set para evitar duplicatas
                const alunosUnicos = new Map();
                const cursosUnicos = new Map();
                const disciplinasUnicas = new Map();

                // Iterar pelas relações e preencher os maps com dados únicos
                relacoes.forEach(item => {
                    // Alunos
                    if (!alunosUnicos.has(item.alunoId)) {
                        alunosUnicos.set(item.alunoId, item.alunoNome);
                    }

                    // Cursos
                    if (!cursosUnicos.has(item.cursoId)) {
                        cursosUnicos.set(item.cursoId, item.cursoDescricao);
                    }

                    // Disciplinas
                    if (!disciplinasUnicas.has(item.disciplinaId)) {
                        disciplinasUnicas.set(item.disciplinaId, item.disciplinaDescricao);
                    }
                });

                // Preencher o select de alunos
                alunosUnicos.forEach((nome, id) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = nome;
                    alunoSelect.appendChild(option);
                });

                // Preencher o select de cursos
                cursosUnicos.forEach((descricao, id) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = descricao;
                    cursoSelect.appendChild(option);
                });

                // Preencher o select de disciplinas
                disciplinasUnicas.forEach((descricao, id) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = descricao;
                    disciplinaSelect.appendChild(option);
                });

            } catch (error) {
                console.error("Erro ao carregar dados:", error);
            }
        };

    </script>
</body>

</html>